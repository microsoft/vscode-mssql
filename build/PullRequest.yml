trigger:
  batch: "true"
  branches:
    include:
      - release/*
pool:
  vmImage: "macos-latest"

steps:
  - pwsh: |
      Write-Host "Installing Yarn"
      npm install --global yarn@1.22.19
      Write-Host "Installing VSCE"
      npm install --global @vscode/vsce@3.7.1
    displayName: Install toolchain

  - pwsh: |
      yarn install --frozen-lockfile
    displayName: Install root dependencies
    workingDirectory: "$(Build.SourcesDirectory)"

  - template: ./templates/build-mssql.yml@self
    parameters:
      packageOffline: false # don't build offline packages for PR builds to speed runs up

  - template: ./templates/build-sql-database-projects.yml@self

  - template: ./templates/build-data-workspace.yml@self

  - template: ./templates/build-database-management-keymap.yml@self

  - task: PublishPipelineArtifact@1
    displayName: Publish artifacts
    inputs:
      targetPath: "$(Build.ArtifactStagingDirectory)/vsix"
      artifact: drop
