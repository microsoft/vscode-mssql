steps:
  - task: UseNode@1
    displayName: "Use Node 22.x"
    inputs:
      version: 22.x

  - pwsh: |
      Write-Host "Installing VSCE"
      npm install --global vsce@2.9.2
    displayName: Keybindings - Install toolchain

  - pwsh: |
      vsce package --no-yarn
    displayName: Keybindings - Package extension
    workingDirectory: "$(Build.SourcesDirectory)/extensions/mssql-database-management-keybindings"

  # using CopyFiles to isolate all .vsix packages because PublishPipelineArtifact can't use wildcards
  - task: CopyFiles@2
    displayName: Keybindings - Copy VSIXs to clean folder
    inputs:
      SourceFolder: "$(Build.SourcesDirectory)/extensions/mssql-database-management-keybindings"
      Contents: "*.vsix"
      TargetFolder: "$(Build.ArtifactStagingDirectory)/vsix"
